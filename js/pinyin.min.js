// Simplified pinyin conversion for Chrome extension
// This is a lightweight implementation for getting first letter of pinyin

(function(global) {
  // 汉字拼音首字母映射表
  const pinyinMap = {
    // 声母表
    '\u3447': 'b', '\u3448': 'p', '\u3449': 'm', '\u344a': 'f', '\u344b': 'd', '\u344c': 't', '\u344d': 'n', '\u344e': 'l',
    '\u344f': 'g', '\u3450': 'k', '\u3451': 'h', '\u3452': 'j', '\u3453': 'q', '\u3454': 'x', '\u3455': 'r', '\u3456': 'z',
    '\u3457': 'c', '\u3458': 's', '\u3459': 'y', '\u345a': 'w',
    
    // 常用汉字映射
    '啊': 'a', '八': 'b', '巴': 'b', '爸': 'b', '白': 'b', '百': 'b', '班': 'b', '半': 'b', '包': 'b', '本': 'b', '比': 'b',
    '边': 'b', '表': 'b', '别': 'b', '宾': 'b', '冰': 'b', '并': 'b', '播': 'b', '不': 'b', '步': 'b', '部': 'b',
    '才': 'c', '菜': 'c', '参': 'c', '仓': 'c', '苍': 'c', '藏': 'c', '操': 'c', '册': 'c', '层': 'c', '茶': 'c',
    '查': 'c', '差': 'c', '拆': 'c', '产': 'c', '厂': 'c', '场': 'c', '畅': 'c', '超': 'c', '朝': 'c', '车': 'c',
    '成': 'c', '城': 'c', '乘': 'c', '程': 'c', '吃': 'c', '池': 'c', '尺': 'c', '齿': 'c', '充': 'c', '虫': 'c',
    '种': 'c', '重': 'c', '出': 'c', '初': 'c', '除': 'c', '处': 'c', '川': 'c', '传': 'c', '船': 'c', '窗': 'c',
    '创': 'c', '吹': 'c', '春': 'c', '词': 'c', '此': 'c', '次': 'c', '从': 'c', '村': 'c', '存': 'c', '错': 'c',
    '大': 'd', '答': 'd', '打': 'd', '达': 'd', '呆': 'd', '代': 'd', '带': 'd', '待': 'd', '担': 'd', '蛋': 'd',
    '当': 'd', '党': 'd', '刀': 'd', '导': 'd', '到': 'd', '道': 'd', '得': 'd', '的': 'd', '灯': 'd', '登': 'd',
    '等': 'd', '低': 'd', '地': 'd', '第': 'd', '店': 'd', '电': 'd', '点': 'd', '定': 'd', '东': 'd', '冬': 'd',
    '董': 'd', '动': 'd', '都': 'd', '斗': 'd', '短': 'd', '段': 'd', '对': 'd', '队': 'd', '顿': 'd', '多': 'd',
    '俄': 'e', '额': 'e', '二': 'e', '儿': 'e', '耳': 'e', '尔': 'e', '饿': 'e', '恩': 'e', '嗯': 'e',
    '发': 'f', '法': 'f', '方': 'f', '放': 'f', '非': 'f', '飞': 'f', '肥': 'f', '分': 'f', '份': 'f', '粉': 'f',
    '风': 'f', '封': 'f', '丰': 'f', '夫': 'f', '福': 'f', '府': 'f', '复': 'f', '改': 'g', '干': 'g', '赶': 'g',
    '敢': 'g', '感': 'g', '刚': 'g', '钢': 'g', '港': 'g', '高': 'g', '告': 'g', '哥': 'g', '歌': 'g', '各': 'g',
    '合': 'h', '河': 'h', '和': 'h', '何': 'h', '红': 'h', '花': 'h', '华': 'h', '画': 'h', '欢': 'h', '还': 'h',
    '回': 'h', '会': 'h', '家': 'j', '加': 'j', '间': 'j', '见': 'j', '建': 'j', '江': 'j', '将': 'j', '节': 'j',
    '界': 'j', '金': 'j', '今': 'j', '进': 'j', '京': 'j', '开': 'k', '看': 'k', '康': 'k', '考': 'k', '可': 'k',
    '克': 'k', '老': 'l', '乐': 'l', '了': 'l', '里': 'l', '力': 'l', '立': 'l', '利': 'l', '林': 'l', '临': 'l',
    '路': 'l', '绿': 'l', '妈': 'm', '马': 'm', '吗': 'm', '买': 'm', '卖': 'm', '满': 'm', '美': 'm', '门': 'm',
    '们': 'm', '面': 'm', '名': 'm', '明': 'm', '哪': 'n', '那': 'n', '呢': 'n', '你': 'n', '年': 'n', '鸟': 'n',
    '牛': 'n', '农': 'n', '女': 'n', '暖': 'n', '朋': 'p', '品': 'p', '平': 'p', '破': 'p', '朴': 'p', '其': 'q',
    '起': 'q', '气': 'q', '千': 'q', '前': 'q', '钱': 'q', '强': 'q', '青': 'q', '秋': 'q', '求': 'q', '取': 'q',
    '去': 'q', '然': 'r', '让': 'r', '热': 'r', '人': 'r', '日': 'r', '如': 'r', '入': 'r', '山': 's', '三': 's',
    '商': 's', '上': 's', '少': 's', '社': 's', '什': 's', '生': 's', '十': 's', '石': 's', '时': 's', '实': 's',
    '使': 's', '事': 's', '手': 's', '守': 's', '书': 's', '树': 's', '水': 's', '说': 's', '四': 's', '送': 's',
    '他': 't', '她': 't', '台': 't', '太': 't', '天': 't', '田': 't', '条': 't', '听': 't', '同': 't', '头': 't',
    '图': 't', '土': 't', '兔': 't', '团': 't', '外': 'w', '万': 'w', '王': 'w', '网': 'w', '往': 'w', '为': 'w',
    '未': 'w', '味': 'w', '温': 'w', '问': 'w', '文': 'w', '我': 'w', '五': 'w', '午': 'w', '物': 'w', '无': 'w',
    '西': 'x', '习': 'x', '细': 'x', '系': 'x', '下': 'x', '夏': 'x', '先': 'x', '现': 'x', '县': 'x', '相': 'x',
    '香': 'x', '小': 'x', '校': 'x', '笑': 'x', '些': 'x', '心': 'x', '信': 'x', '星': 'x', '行': 'x', '形': 'x',
    '型': 'x', '学': 'x', '血': 'x', '雪': 'x', '牙': 'y', '言': 'y', '眼': 'y', '羊': 'y', '阳': 'y', '样': 'y',
    '药': 'y', '要': 'y', '也': 'y', '业': 'y', '夜': 'y', '一': 'y', '衣': 'y', '医': 'y', '意': 'y', '因': 'y',
    '音': 'y', '印': 'y', '应': 'y', '营': 'y', '用': 'y', '由': 'y', '友': 'y', '有': 'y', '月': 'y', '运': 'y',
    '再': 'z', '在': 'z', '战': 'z', '站': 'z', '张': 'z', '长': 'z', '章': 'z', '照': 'z', '这': 'z', '真': 'z',
    '正': 'z', '证': 'z', '之': 'z', '知': 'z', '中': 'z', '种': 'z', '重': 'z', '周': 'z', '主': 'z', '住': 'z',
    '助': 'z', '祝': 'z', '自': 'z', '子': 'z', '走': 'z', '最': 'z', '作': 'z', '座': 'z',
    // 添加更多常用字
    '线': 'x', '记': 'j', '录': 'l', '猫': 'm', '商': 's',
    '家': 'j', '及': 'j', '品': 'p', '关': 'g', '联': 'l', '数': 's', '据': 'j', '配': 'p', '置': 'z',
    '象': 'x', '班': 'b'
  };

  /**
   * 获取中文文本的拼音首字母
   * @param {string} text - 输入文本
   * @returns {string} 拼音首字母组成的字符串
   */
  function getFirstPinyinLetters(text) {
    if (!text) return '';
    
    let result = '';
    
    for (let i = 0; i < text.length; i++) {
      const char = text[i];
      
      // 如果是英文字母，直接转为小写添加
      if (/[a-zA-Z]/.test(char)) {
        result += char.toLowerCase();
        continue;
      }
      
      // 查找对应的拼音首字母
      if (pinyinMap[char]) {
        result += pinyinMap[char];
      } else {
        // 如果找不到对应拼音，保留原字符（通常是符号或数字）
        if (/[\u4e00-\u9fa5]/.test(char)) {
          // 如果是中文字符但没在映射表中，尝试使用通用方法
          result += getFirstLetterByUnicode(char);
        } else {
          // 非中文字符则跳过
        }
      }
    }
    
    return result;
  }

  /**
   * 通过Unicode范围判断中文字符的拼音首字母
   * @param {string} char - 单个字符
   * @returns {string} 拼音首字母
   */
  function getFirstLetterByUnicode(char) {
    const unicode = char.charCodeAt(0);
    
    // 定义拼音首字母的Unicode范围
    if (unicode >= 19968 && unicode <= 40869) {
      // 基于Unicode值进行粗略分类
      if (unicode >= 20000 && unicode < 20200) return 'a'; // 包含 啊, 阿 等
      if (unicode >= 20200 && unicode < 20400) return 'b'; // 包含 八, 白, 等
      if (unicode >= 20400 && unicode < 20700) return 'c'; // 包含 才, 菜, 等
      if (unicode >= 20700 && unicode < 21100) return 'd'; // 包含 大, 打, 等
      if (unicode >= 21100 && unicode < 21300) return 'e'; // 包含 饿, 额, 等
      if (unicode >= 21300 && unicode < 21600) return 'f'; // 包含 发, 法, 等
      if (unicode >= 21600 && unicode < 22000) return 'g'; // 包含 高, 歌, 等
      if (unicode >= 22000 && unicode < 22400) return 'h'; // 包含 好, 合, 等
      if (unicode >= 22400 && unicode < 23000) return 'j'; // 包含 家, 加, 等
      if (unicode >= 23000 && unicode < 23400) return 'k'; // 包含 开, 看, 等
      if (unicode >= 23400 && unicode < 23800) return 'l'; // 包含 来, 了, 等
      if (unicode >= 23800 && unicode < 24200) return 'm'; // 包含 妈, 马, 等
      if (unicode >= 24200 && unicode < 24600) return 'n'; // 包含 你, 年, 等
      if (unicode >= 24600 && unicode < 24800) return 'o'; // 包含 欧, 偶, 等
      if (unicode >= 24800 && unicode < 25200) return 'p'; // 包含 破, 跑, 等
      if (unicode >= 25200 && unicode < 25600) return 'q'; // 包含 七, 器, 等
      if (unicode >= 25600 && unicode < 26000) return 'r'; // 包含 人, 日, 等
      if (unicode >= 26000 && unicode < 26600) return 's'; // 包含 三, 四, 等
      if (unicode >= 26600 && unicode < 27100) return 't'; // 包含 他, 天, 等
      if (unicode >= 27100 && unicode < 27800) return 'w'; // 包含 我, 万, 等
      if (unicode >= 27800 && unicode < 28500) return 'x'; // 包含 下, 小, 等
      if (unicode >= 28500 && unicode < 29200) return 'y'; // 包含 一, 有, 等
      if (unicode >= 29200 && unicode < 40869) return 'z'; // 包含 在, 早, 等
    }
    
    return ''; // 无法确定则返回空
  }

  // 导出函数
  global.getPinyinFirstLetters = getFirstPinyinLetters;
  
})(typeof window !== 'undefined' ? window : global);